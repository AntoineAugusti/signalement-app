<section class="section section-white position-relative">
  <div class="container">
    <form [formGroup]="searchForm" (submit)="searchCompany()" id="searchForm">
      <div class="form__group">
        <label for="searchInput">Nom ou enseigne de l'établissement <span>*</span>
        </label>
        <input type="text" class="form-control" formControlName="search" name="search" id="searchInput" placeholder="ex : boulangerie Petit Jean" />
      </div>

      <div class="form__group">
        <label for="searchPostalCodeInput">
          Code postal <span>*</span>
        </label>
        <div class="row">
          <div class="col-12 col-sm-6">
            <input type="text" class="form-control" formControlName="searchPostalCode" name="searchPostalCode" id="searchPostalCodeInput" placeholder="ex : 75001" />
          </div>
        </div>
      </div>
      <div class="notification error mt-3" *ngIf="showErrors && searchForm.invalid">
        <span *ngIf="searchCtrl.hasError('required')">
          Veuillez renseigner le nom de l'établissement.<br />
        </span>
        <span *ngIf="searchPostalCodeCtrl.hasError('required')">
          Veuillez renseigner le code postal.
        </span>
        <span *ngIf="searchPostalCodeCtrl.hasError('pattern')">
          Le code postal doit être composé de 5 chiffres.
        </span>
      </div>
      <div class="text-center mt-3">
        <button type="submit" class="btn btn-lg btn-primary">Rechercher</button>
      </div>


      <div *ngIf="companies && companies.length">

        <div class="notification warning mt-4">
          Veuillez sélectionner un établissement dans la liste ci-dessous.
        </div>

        <p *ngFor="let company of companies" class="company" (click)="selectCompanyFromResults(company)">
          <span *ngIf="company.line1">{{company.line1}}<br /></span>
          <span *ngIf="company.line2">{{company.line2}}<br /></span>
          <span *ngIf="company.line3">{{company.line3}}<br /></span>
          <span *ngIf="company.line4">{{company.line4}}<br /></span>
          <span *ngIf="company.line5">{{company.line5}}<br /></span>
          <span *ngIf="company.line6">{{company.line6}}<br /></span>
          <span *ngIf="company.line7">{{company.line7}}<br /></span>
        </p>
      </div>

      <div class="notification error mt-4" *ngIf="searchWarning">
        <p>
          {{searchWarning}}
        </p>
        Veuillez modifier votre recherche ou <span class="link" (click)="editCompany()">saisir l'établissement manuellement</span>.
      </div>
    </form>

    <form [formGroup]="companyForm" (submit)="submitCompanyForm()" id="companyForm" *ngIf="companyForm">

      <div class="form__group">
        <label for="companyName">
          Nom de l'établissement <span>*</span>
        </label>
        <input formControlName="name" type="text" id="companyName" placeholder="Nom de l'établissement">
      </div>

      <div class="form__group">
        <label for="companyAddress">
          Adresse de l'établissement <span>*</span>
        </label>
        <ng2-completer
          [datasource]="addressData"
          formControlName="address"
          inputName="address"
          inputId="companyAddress"
          textSearching=""
          textNoResults=""
          minSearchLength="1"
          placeholder="numéro, voie, code postal, ville, ..."
          (selected)="selectAddress($event)">
        </ng2-completer>
      </div>

      <div class="notification error mt-3" *ngIf="showErrors && companyForm.invalid">
        <span *ngIf="nameCtrl.hasError('required')">
          Veuillez renseigner le nom de l'établissement.<br />
        </span>
        <span *ngIf="addressCtrl.hasError('required')">
          Veuillez renseigner l'adresse de l'établissement.
        </span>
      </div>
      <hr />
      <div class="text-center mt-3">
        <button type="submit" class="btn btn-lg btn-primary" id="submitCompanyForm">Suite</button>
      </div>

    </form>

  </div>

  <ngx-loading [show]="loading"></ngx-loading>

</section>
