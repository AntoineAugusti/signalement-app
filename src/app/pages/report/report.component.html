<ng-container *ngIf="isStep('Category')">
  <div class="banner text-center section section-primary" role="banner">
    <div class="container">
      <h1>
        Signalez un problème au commerçant et à la répression des fraudes
      </h1>
      <h3>
        Magasins, commerces de proximité, cafés et restaurants...
      </h3>
    </div>
  </div>

  <main role="main">
    <section class="section section-lightest-grey position-relative">

      <div class="container">
        <h3 class="text-center">Quel est le problème ?</h3>
        <div class="row pb-4">
          <div class="col-12 col-sm-6 col-md-4" *ngFor="let category of primaryCategoriesOrderByRank()">
            <div class="category pointer" (click)="selectAnomaly(category)">
              <div class="row">
                <div class="col-12 col-lg-3 mb-2 text-center">
                  <img src="/assets/images/{{category.icon}}" alt="Icône catégorie de problème" *ngIf="category.icon"/>
                </div>
                <div class="col-12 col-lg-9 pl-lg-0">
                  <h5 class="mb-0">{{category.category}}</h5>
                  <span class="note">{{category.description}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <h3 class="text-center pointer" (click)="displaySecondaryCategories()" *ngIf="!showSecondaryCategories; else secondaryCategories;">
          <u>Mon problème n'est pas dans la liste</u>
        </h3>
        <ng-template #secondaryCategories>
          <h3 class="text-center">
            Autres problèmes
          </h3>
          <ul>
            <li *ngFor="let category of secondaryCategoriesOrderByRank()" class="pointer" (click)="selectAnomaly(category)">
              <h5><u>{{category.category}}</u></h5>
            </li>
          </ul>
        </ng-template>
      </div>
    </section>

    <section class="section section-lighter-grey">
      <div class="container">
        <div class="row">
          <div class="col-12 col-sm-4 pl-sm-4 pr-sm-4">
            <div class="icon">
              <img src="/assets/images/icon_fast.png" alt="Icône magasin"/>
            </div>
            <p class="text-center"><b>Rapide</b></p>
            <p>
              Des questions simples pour vous guider afin de signaler rapidement votre problème et connaître vos droits.
            </p>
          </div>
          <div class="col-12 col-sm-4 pl-sm-4 pr-sm-4">
            <div class="icon">
              <img src="/assets/images/icon_approbation.png" alt="Icône workflow"/>
            </div>
            <p class="text-center"><b>Transparent</b></p>
            <p>
              Le commerçant, s’il le souhaite, a accès aux signalements. Cela lui permet de procéder spontanément aux corrections utiles, sans sanction.
            </p>
          </div>
          <div class="col-12 col-sm-4 pl-sm-4 pr-sm-4">
            <div class="icon">
              <img src="/assets/images/icon_collaboration.png" alt="Icône alarme"/>
            </div>
            <p class="text-center"><b>Participatif</b></p>
            <p>
              Vous êtes plusieurs à signaler les mêmes anomalies et la situation perdure ? Les enquêteurs de la répression des fraudes seront avertis afin d’intervenir.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Information')">
  <main role="main">
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <section class="section section-white">
      <div class="container max-width">
        <h4 class="text-center">{{informationToDisplay.title}}</h4>
        <hr />
        <p class="mt-4" [innerHTML]="informationToDisplay.content"></p>
        <hr />
        <button class="btn btn-lg btn-primary" (click)="ngOnInit()">
          Identifier un autre problème
        </button>
      </div>
    </section>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Subcategory')">
  <main>
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <app-subcategory
      [initialValue]="report.subcategory"
      [anomalySubcategories]="getSubcategories()"
      (validate)="onSubcategoryValidate($event)">
    </app-subcategory>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Details')">
  <main>
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <app-details
      [initialValue]="report.details"
      [subcategoryDetails]="report.subcategory?.details"
      (validate)="onDetailsValidate($event)">
    </app-details>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Company')">
  <main>
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <app-company (validate)="onCompanyValidate($event)"></app-company>
  </main>
</ng-container>


<ng-container *ngIf="isStep('Consumer')">
  <main>
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <app-consumer
      [initialValue]="report.consumer"
      (validate)="onConsumerValidate($event)">
    </app-consumer>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Confirmation')">
  <main>
    <app-breadcrumb [step]="step" [report]="report" (back)="stepBackward()"></app-breadcrumb>
    <app-confirmation
      [report]="report"
      (validate)="onConfimationValidate()">
    </app-confirmation>
  </main>
</ng-container>

<ng-container *ngIf="isStep('Acknowledgment')">
  <main role="main">
    <section class="section-small section-lighter-grey">
      <div class="container">
        <h1 class="text-center">Merci pour votre signalement</h1>
      </div>
    </section>
    <section class="section section-white">
      <div class="container max-width">
        <div class="mt-4" *ngIf="report.contactAgreement">
          <p>
            Votre signalement va être communiqué au commerçant.
            Il pourra corriger directement le problème grâce à vos informations. Votre nom et vos coordonnées lui seront communiqués s’il souhaite vous répondre.
          </p>
          <p>
            Votre signalement est aussi transmis à la répression des fraudes (DGCCRF).
            Si votre problème concerne d’autres consommateurs, la répression des fraudes fera un contrôle de l’établissement.
          </p>
          <p>
            En cas d’erreur sur votre signalement, envoyez un email à <a href="mailto:contact@signalement.beta.gouv.fr?subject=incident" target="_blank">contact@signalement.beta.gouv.fr</a>
          </p>
        </div>
        <div class="mt-4" *ngIf="!report.contactAgreement">
          <p>
            Votre signalement va être communiqué de façon anonyme au commerçant.
            Il pourra corriger directement le problème grâce à vos informations.
          </p>
          <p>
            Votre signalement est aussi transmis à la répression des fraudes (DGCCRF).
            Si votre problème concerne d’autres consommateurs, la répression des fraudes fera un contrôle de l’établissement.
          </p>
          <p>
            En cas d’erreur sur votre signalement, envoyez un email à <a href="mailto:contact@signalement.beta.gouv.fr?subject=incident" target="_blank">contact@signalement.beta.gouv.fr</a>
          </p>
        </div>
        <hr />
        <button class="btn btn-lg btn-primary" (click)="ngOnInit()">
          Identifier un autre problème
        </button>
      </div>
    </section>
  </main>
</ng-container>
